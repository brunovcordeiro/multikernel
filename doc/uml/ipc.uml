@startuml

namespace HAL {

	interface HAL.MailboxInterface {
		+ const int HAL_NR_MAILBOX
		+ const int HAL_MAILBOX_MSG_SIZE
		+ int hal_mailbox_create(int)
		+ int hal_mailbox_open(int)
		+ int hal_mailbox_unlink(int)
		+ int hal_mailbox_close(int)
		+ size_t hal_mailbox_write(int, const void *, size_t)
		+ size_t hal_mailbox_read(int, void *, size_t)
	}

	interface HAL.NoCInterface {
		+ const int HAL_NR_NOC_IONODES
		+ const int HAL_NR_NOC_CNODES
		+ const int HAL_NR_NOC_NODES
		+ const int hal_noc_nodes[HAL_NR_NOC_NODES]
		+ int hal_get_node_id(void)
	}
}

namespace IPC {
	class NameClient {
		+ int sys_name_link(int nodeid, const char *name)
		+ int sys_name_unlink(const char *name)
		+ int sys_name_lookup(char *name)
		+ void name_finalize(void)
		- int name_init(void)
		- int initialized = 0;
		- int server;
	}

	class NameMessage {
		+ uint16_t source
		+ uint16_t op
		+ int32_t nodeid
		+ char name[NANVIX_PROC_NAME_MAX]
	}

	enum NameMessageTypes {
		+ const int NAME_LOOKUP
		+ const int NAME_LINK
		+ const int NAME_UNLINK
		+ const int NAME_SUCCESS
		+ const int NAME_FAIL
	}

	class Mailbox {
		+ char name[NANVIX_PROC_NAME_MAX]
		+ int fd
		+ int flags
	}

	class MailboxInterface {
		- const int MAILBOX_USED
		- const int MAILBOX_WRONLY
		- int inboxes[HAL_NR_NOC_IONODES];
		- int initialized[HAL_NR_NOC_IONODES] = { 0, };
		- struct mailbox mailboxes[HAL_NR_MAILBOX]
		- int mailbox_alloc(void)
		- void mailbox_free(int mbxid)
		- void unset_inbox()
		+ int destroy_inbox(int index)
		+ int get_inbox(void)
		+ int initialize_inbox(int index)
		+ int mailbox_create(char *name)
		+ int mailbox_open(char *name)
		+ int mailbox_read(int mbxid, void *buf, size_t)
		+ int mailbox_write(int mbxid, const void *buf, size_t)
		+ int mailbox_close(int mbxid)
		+ int mailbox_unlink(int mbxid)
	}

	IPC.NameMessage  .> IPC.NameMessageTypes : <<use>>
	IPC.NameClient   .> IPC.NameMessage      : <<use>>
	IPC.NameClient  ..> HAL.NoCInterface     : <<use>>
	IPC.NameClient  ..> HAL.MailboxInterface : <<use>>
	IPC.NameClient  ..> IPC.MailboxInterface : <<use>>

	IPC.MailboxInterface   .> IPC.Mailbox           : <<use>>
	IPC.MailboxInterface   .> HAL.MailboxInterface  : <<use>>
	IPC.MailboxInterface   .> HAL.NoCInterface      : <<use>>
	IPC.MailboxInterface   .> NameClient            : <<use>>
}

@enduml
